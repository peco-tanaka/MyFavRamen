<!-- 追加: Stimulusコントローラーを接続し、検索キーワードを設定 -->
<div class="container mt-2" data-controller="maps"
    data-maps-keyword-value="<%= @search_keyword %>"
    data-maps-has-db-results-value="<%= @has_db_results || false %>"
    <% if defined?(@shop) && @shop.present? && @shop.latitude.present? && @shop.longitude.present? %>
      data-maps-latitude-value="<%= @shop.latitude %>"
      data-maps-longitude-value="<%= @shop.longitude %>"
      data-maps-shop-name-value="<%= @shop.name %>"
      data-maps-is-detail-page-value="true"
    <% else %>
      data-maps-is-detail-page-value="false"
    <% end %>>
  <%# 検索フォーム %>
  <div class="row">
    <div class="col-12 col-md-8 col-lg-6 mb-1">
      <!-- 追加: フォームにStimulusターゲットとアクションを追加 -->
      <%= form_with url: shops_path, method: :get, local: true,
                    data: { maps_target: "searchForm", action: "submit->maps#search" } do |f| %>
        <div class="card">
          <div class="card-body">
            <div class="d-flex">
              <!-- 追加: 入力フィールドにStimulusターゲットを追加 -->
              <%= f.text_field :keyword, class: "form-control", placeholder: "店舗名",
                                autofocus: true, data: { maps_target: "searchInput" } %>
              <div class="ms-2">
                <%= f.submit "検索", class: "btn btn-primary" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

  <div class="col-12 col-md-8 col-lg-6 mb-1">
    <div class="card">
      <div class="card-body">
        <p class="card-title small">検索結果</p>
        <% if @shops.present? %>
        <%# ここに両方の検索結果が入る %>
          <div class="list-group" id="database-results">
            <% @shops.each do |shop| %>
              <%= link_to shop_path(shop), class: "list-group-item list-group-item-action" do %>
                <h5 class="mb-1"><%= shop.name %></h5>
                <p class="mb-1"><% shop.address %></p>
                <span class="badge bg-primary">データベース登録済み</span>
              <% end %>
            <% end %>
          </div>
        <% end %>

        <%# 検索結果を表示 %>
        <div data-maps-target="searchResults"></div>

        <%# 検索結果がない場合のメッセージ %>
        <div data-maps-target="noResultsMessage" style="display: none;">
          <p class="alert alert-info mt-2">検索結果がありませんでした</p>
        </div>
      </div>
    </div>
  </div>

    <%# Google Map表示。検索画面と店舗詳細場面で分岐 %>
    <% if defined?(@shop) && @shop.present? && @shop.latitude.present? && @shop.longitude.present? %>
      <%= render "shared/google_map",
            latitude: @shop.latitude,
            longitude: @shop.longitude,
            shop_name: @shop.name,
            is_detail_page: true %>
    <% else %>
      <%= render "shared/google_map", is_detail_page: false %>
    <% end %>

  </div>
</div>